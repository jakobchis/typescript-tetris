var G=Object.defineProperty,N=Object.defineProperties;var B=Object.getOwnPropertyDescriptors;var A=Object.getOwnPropertySymbols;var D=Object.prototype.hasOwnProperty,K=Object.prototype.propertyIsEnumerable;var S=(e,o,s)=>o in e?G(e,o,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[o]=s,g=(e,o)=>{for(var s in o||(o={}))D.call(o,s)&&S(e,s,o[s]);if(A)for(var s of A(o))K.call(o,s)&&S(e,s,o[s]);return e},p=(e,o)=>N(e,B(o));var c=(e,o,s)=>(S(e,typeof o!="symbol"?o+"":o,s),s);const T=function(){const o=document.createElement("link").relList;if(o&&o.supports&&o.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))t(n);new MutationObserver(n=>{for(const P of n)if(P.type==="childList")for(const E of P.addedNodes)E.tagName==="LINK"&&E.rel==="modulepreload"&&t(E)}).observe(document,{childList:!0,subtree:!0});function s(n){const P={};return n.integrity&&(P.integrity=n.integrity),n.referrerpolicy&&(P.referrerPolicy=n.referrerpolicy),n.crossorigin==="use-credentials"?P.credentials="include":n.crossorigin==="anonymous"?P.credentials="omit":P.credentials="same-origin",P}function t(n){if(n.ep)return;n.ep=!0;const P=s(n);fetch(n.href,P)}};T();class a{constructor(o,s,t,n){c(this,"type");c(this,"colour");c(this,"orientationIndex");c(this,"orientations");c(this,"getCurrentOrientation",()=>this.orientations[this.orientationIndex]);c(this,"getOrientation",o=>this.orientations[o]);c(this,"getOrientations",()=>this.orientations);c(this,"getNextOrientationIndex",()=>this.orientationIndex+1<this.orientations.length?this.orientationIndex+1:0);c(this,"setOrientation",o=>{this.orientationIndex=o});this.type=o,this.colour=s,this.orientationIndex=t,this.orientations=n}}const f=()=>{for(var e="0123456789ABCDEF",o="#",s=0;s<6;s++)o+=e[Math.floor(Math.random()*16)];return o};class $ extends a{constructor(o){const s="IPiece",t=o!=null?o:f(),n=0,P=[[{xPos:100,yPos:25},{xPos:125,yPos:25},{xPos:150,yPos:25},{xPos:175,yPos:25}],[{xPos:150,yPos:0},{xPos:150,yPos:25},{xPos:150,yPos:50},{xPos:150,yPos:75}],[{xPos:100,yPos:50},{xPos:125,yPos:50},{xPos:150,yPos:50},{xPos:175,yPos:50}],[{xPos:125,yPos:0},{xPos:125,yPos:25},{xPos:125,yPos:50},{xPos:125,yPos:75}]];super(s,t,n,P)}}class J extends a{constructor(o){const s="JPiece",t=o!=null?o:f(),n=0,P=[[{xPos:100,yPos:0},{xPos:100,yPos:25},{xPos:125,yPos:25},{xPos:150,yPos:25}],[{xPos:125,yPos:0},{xPos:150,yPos:0},{xPos:125,yPos:25},{xPos:125,yPos:50}],[{xPos:100,yPos:25},{xPos:125,yPos:25},{xPos:150,yPos:25},{xPos:150,yPos:50}],[{xPos:125,yPos:0},{xPos:125,yPos:25},{xPos:125,yPos:50},{xPos:100,yPos:50}]];super(s,t,n,P)}}class W extends a{constructor(o){const s="LPiece",t=o!=null?o:f(),n=0,P=[[{xPos:100,yPos:25},{xPos:125,yPos:25},{xPos:150,yPos:25},{xPos:150,yPos:0}],[{xPos:125,yPos:0},{xPos:125,yPos:25},{xPos:125,yPos:50},{xPos:150,yPos:50}],[{xPos:100,yPos:25},{xPos:100,yPos:50},{xPos:125,yPos:25},{xPos:150,yPos:25}],[{xPos:100,yPos:0},{xPos:125,yPos:0},{xPos:125,yPos:25},{xPos:125,yPos:50}]];super(s,t,n,P)}}class Z extends a{constructor(o){const s="OPiece",t=o!=null?o:f(),n=0,P=[[{xPos:125,yPos:0},{xPos:150,yPos:0},{xPos:125,yPos:25},{xPos:150,yPos:25}]];super(s,t,n,P)}}class z extends a{constructor(o){const s="SPiece",t=o!=null?o:f(),n=0,P=[[{xPos:100,yPos:25},{xPos:125,yPos:25},{xPos:125,yPos:0},{xPos:150,yPos:0}],[{xPos:125,yPos:0},{xPos:125,yPos:25},{xPos:150,yPos:25},{xPos:150,yPos:50}],[{xPos:100,yPos:50},{xPos:125,yPos:50},{xPos:125,yPos:25},{xPos:150,yPos:25}],[{xPos:100,yPos:0},{xPos:100,yPos:25},{xPos:125,yPos:25},{xPos:125,yPos:50}]];super(s,t,n,P)}}class H extends a{constructor(o){const s="TPiece",t=o!=null?o:f(),n=0,P=[[{xPos:100,yPos:25},{xPos:125,yPos:0},{xPos:125,yPos:25},{xPos:150,yPos:25}],[{xPos:125,yPos:0},{xPos:125,yPos:25},{xPos:125,yPos:50},{xPos:150,yPos:25}],[{xPos:100,yPos:25},{xPos:125,yPos:25},{xPos:125,yPos:50},{xPos:150,yPos:25}],[{xPos:100,yPos:25},{xPos:125,yPos:0},{xPos:125,yPos:25},{xPos:125,yPos:50}]];super(s,t,n,P)}}class Q extends a{constructor(o){const s="ZPiece",t=o!=null?o:f(),n=0,P=[[{xPos:100,yPos:0},{xPos:125,yPos:0},{xPos:125,yPos:25},{xPos:150,yPos:25}],[{xPos:125,yPos:25},{xPos:125,yPos:50},{xPos:150,yPos:0},{xPos:150,yPos:25}],[{xPos:100,yPos:25},{xPos:125,yPos:25},{xPos:125,yPos:50},{xPos:150,yPos:50}],[{xPos:100,yPos:25},{xPos:100,yPos:50},{xPos:125,yPos:0},{xPos:125,yPos:25}]];super(s,t,n,P)}}const l=[$,J,W,Z,z,H,Q],k={height:22,width:12};let m,O,i,d,w=0,r,x,y=[],U=1e3,j=1,M=!1,v=[],I;const L=e=>{const o=l.find(t=>t.name===e.type);if(!o)throw new Error;const s=l.indexOf(o);return new l[s](e.colour)},R=()=>new l[Math.floor(Math.random()*l.length)],b=e=>{if(M)v.push("Game over!"),cancelAnimationFrame(I);else{w===void 0&&(w=e);let o=e-w;o>U&&(u("down"),V(),w=e,o=0),I=requestAnimationFrame(b)}F()},V=()=>{for(let e=0;e<k.height;e++){const o=y.filter(s=>s.yPos===e*25);o.length===k.width&&(v.push("Line clear!"),o.forEach(s=>{y.splice(y.indexOf(s),1)}),y.forEach(s=>{s.yPos<e*25&&(s.yPos+=25)}))}},F=()=>{i.fillStyle="White",i.fillRect(0,0,m.width,m.height),i.strokeStyle="LightGray";for(let o=0;o<300;o+=25)for(let s=0;s<550;s+=25)i.strokeRect(o,s,25,25);d.fillStyle="White",d.fillRect(0,0,O.width,O.height),d.strokeStyle="LightGray";for(let o=0;o<100;o+=25)for(let s=0;s<100;s+=25)d.strokeRect(o,s,25,25);const e=document.getElementById("gameMessages");e&&(e.innerHTML=v.reduce((o,s)=>`${o}${s}<br>`,`Game speed: ${j}<br>Game messages:<br>`)),r.getCurrentOrientation().forEach(o=>{i.fillStyle=r.colour,i.fillRect(o.xPos,o.yPos,25,25)}),y.forEach(o=>{i.fillStyle=o.colour,i.fillRect(o.xPos,o.yPos,25,25)}),x==null||x.getOrientation(0).forEach(o=>{d.fillStyle=x.colour,d.fillRect(o.xPos-100,o.yPos,25,25)})},X=e=>!!e.find(o=>y.find(s=>o.xPos===s.xPos&&o.yPos===s.yPos)),h=e=>e.find(o=>o.yPos>525||o.yPos<0||o.xPos<0||o.xPos>275||y.find(s=>s.yPos===o.yPos&&s.xPos===o.xPos)),u=e=>{if(e==="up"){const o=r.getNextOrientationIndex(),s=r.getOrientation(o).map(t=>({xPos:t.xPos,yPos:t.yPos}));if(h(s))return;r.setOrientation(o)}if(e==="down"){const o=r.getCurrentOrientation().map(s=>({xPos:s.xPos,yPos:s.yPos+25}));if(h(o)){const s=r.getCurrentOrientation().map(n=>p(g({},n),{colour:r.colour}));y.push(...s);const t=R();X(t.getCurrentOrientation())?M=!0:r=t;return}r.getOrientations().forEach(s=>{s.forEach(t=>t.yPos+=25)})}if(e==="left"){const o=r.getCurrentOrientation().map(s=>p(g({},s),{xPos:s.xPos-25}));if(h(o))return;r.getOrientations().forEach(s=>{s.forEach(t=>t.xPos-=25)})}if(e==="right"){const o=r.getCurrentOrientation().map(s=>p(g({},s),{xPos:s.xPos+25}));if(h(o))return;r.getOrientations().forEach(s=>{s.forEach(t=>t.xPos+=25)})}},Y=()=>{let e=!0;for(;e;){const o=r.getCurrentOrientation().map(s=>({xPos:s.xPos,yPos:s.yPos+25}));if(h(o)){e=!1;return}r.getOrientations().forEach(s=>{s.forEach(t=>t.yPos+=25)})}},_=e=>{if(I||(I=requestAnimationFrame(b)),e.code==="ArrowDown")u("down");else if(e.code==="ArrowLeft")u("left");else if(e.code==="ArrowRight")u("right");else if(e.code==="ArrowUp")u("up");else if(e.code==="KeyQ")if(x){const o=L(r);r=L(x),x=o}else x=L(r),r=R();else e.code==="Space"&&Y()};addEventListener("load",()=>{m=document.getElementById("mainCanvas"),O=document.getElementById("extraInfoCanvas"),i=m.getContext("2d"),d=O.getContext("2d"),r=R(),document.onkeydown=_,F()});
