var N=Object.defineProperty,T=Object.defineProperties;var b=Object.getOwnPropertyDescriptors;var S=Object.getOwnPropertySymbols;var F=Object.prototype.hasOwnProperty,G=Object.prototype.propertyIsEnumerable;var w=(s,o,e)=>o in s?N(s,o,{enumerable:!0,configurable:!0,writable:!0,value:e}):s[o]=e,d=(s,o)=>{for(var e in o||(o={}))F.call(o,e)&&w(s,e,o[e]);if(S)for(var e of S(o))G.call(o,e)&&w(s,e,o[e]);return s},u=(s,o)=>T(s,b(o));var i=(s,o,e)=>(w(s,typeof o!="symbol"?o+"":o,e),e);import{l as B}from"./vendor.5ac9174a.js";const D=function(){const o=document.createElement("link").relList;if(o&&o.supports&&o.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))P(n);new MutationObserver(n=>{for(const r of n)if(r.type==="childList")for(const O of r.addedNodes)O.tagName==="LINK"&&O.rel==="modulepreload"&&P(O)}).observe(document,{childList:!0,subtree:!0});function e(n){const r={};return n.integrity&&(r.integrity=n.integrity),n.referrerpolicy&&(r.referrerPolicy=n.referrerpolicy),n.crossorigin==="use-credentials"?r.credentials="include":n.crossorigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function P(n){if(n.ep)return;n.ep=!0;const r=e(n);fetch(n.href,r)}};D();const K=()=>{for(var s="0123456789ABCDEF",o="#",e=0;e<6;e++)o+=s[Math.floor(Math.random()*16)];return o},v=["IPiece","JPiece","LPiece","OPiece","SPiece","TPiece","ZPiece"],$={IPiece:[[{xPos:100,yPos:25},{xPos:125,yPos:25},{xPos:150,yPos:25},{xPos:175,yPos:25}],[{xPos:150,yPos:0},{xPos:150,yPos:25},{xPos:150,yPos:50},{xPos:150,yPos:75}],[{xPos:100,yPos:50},{xPos:125,yPos:50},{xPos:150,yPos:50},{xPos:175,yPos:50}],[{xPos:125,yPos:0},{xPos:125,yPos:25},{xPos:125,yPos:50},{xPos:125,yPos:75}]],JPiece:[[{xPos:100,yPos:0},{xPos:100,yPos:25},{xPos:125,yPos:25},{xPos:150,yPos:25}],[{xPos:125,yPos:0},{xPos:150,yPos:0},{xPos:125,yPos:25},{xPos:125,yPos:50}],[{xPos:100,yPos:25},{xPos:125,yPos:25},{xPos:150,yPos:25},{xPos:150,yPos:50}],[{xPos:125,yPos:0},{xPos:125,yPos:25},{xPos:125,yPos:50},{xPos:100,yPos:50}]],LPiece:[[{xPos:100,yPos:25},{xPos:125,yPos:25},{xPos:150,yPos:25},{xPos:150,yPos:0}],[{xPos:125,yPos:0},{xPos:125,yPos:25},{xPos:125,yPos:50},{xPos:150,yPos:50}],[{xPos:100,yPos:25},{xPos:100,yPos:50},{xPos:125,yPos:25},{xPos:150,yPos:25}],[{xPos:100,yPos:0},{xPos:125,yPos:0},{xPos:125,yPos:25},{xPos:125,yPos:50}]],OPiece:[[{xPos:125,yPos:0},{xPos:150,yPos:0},{xPos:125,yPos:25},{xPos:150,yPos:25}]],SPiece:[[{xPos:100,yPos:25},{xPos:125,yPos:25},{xPos:125,yPos:0},{xPos:150,yPos:0}],[{xPos:125,yPos:0},{xPos:125,yPos:25},{xPos:150,yPos:25},{xPos:150,yPos:50}],[{xPos:100,yPos:50},{xPos:125,yPos:50},{xPos:125,yPos:25},{xPos:150,yPos:25}],[{xPos:100,yPos:0},{xPos:100,yPos:25},{xPos:125,yPos:25},{xPos:125,yPos:50}]],TPiece:[[{xPos:100,yPos:25},{xPos:125,yPos:0},{xPos:125,yPos:25},{xPos:150,yPos:25}],[{xPos:125,yPos:0},{xPos:125,yPos:25},{xPos:125,yPos:50},{xPos:150,yPos:25}],[{xPos:100,yPos:25},{xPos:125,yPos:25},{xPos:125,yPos:50},{xPos:150,yPos:25}],[{xPos:100,yPos:25},{xPos:125,yPos:0},{xPos:125,yPos:25},{xPos:125,yPos:50}]],ZPiece:[[{xPos:100,yPos:0},{xPos:125,yPos:0},{xPos:125,yPos:25},{xPos:150,yPos:25}],[{xPos:125,yPos:25},{xPos:125,yPos:50},{xPos:150,yPos:0},{xPos:150,yPos:25}],[{xPos:100,yPos:25},{xPos:125,yPos:25},{xPos:125,yPos:50},{xPos:150,yPos:50}],[{xPos:100,yPos:25},{xPos:100,yPos:50},{xPos:125,yPos:0},{xPos:125,yPos:25}]]};class L{constructor(o,e,P){i(this,"type");i(this,"colour");i(this,"orientationIndex");i(this,"orientations");i(this,"getCurrentOrientation",()=>this.orientations[this.orientationIndex]);i(this,"getOrientation",o=>this.orientations[o]);i(this,"getOrientations",()=>this.orientations);i(this,"getNextOrientationIndex",()=>this.orientationIndex+1<this.orientations.length?this.orientationIndex+1:0);i(this,"setOrientation",o=>{this.orientationIndex=o});this.type=o,this.colour=e,this.orientationIndex=P,this.orientations=B.exports.cloneDeep($[o])}}const R={height:22,width:12};let h,g,y,l,m=0,t,x,c=[],J=1e3,W=1,A=!1,E=[],p;const C=s=>new L(s.type,s.colour,0),I=()=>{const s=v[Math.floor(Math.random()*v.length)];return new L(s,K(),0)},k=s=>{if(A)E.push("Game over!"),cancelAnimationFrame(p);else{m===void 0&&(m=s);let o=s-m;o>J&&(f("down"),Z(),m=s,o=0),p=requestAnimationFrame(k)}M()},Z=()=>{for(let s=0;s<R.height;s++){const o=c.filter(e=>e.yPos===s*25);o.length===R.width&&(E.push("Line clear!"),o.forEach(e=>{c.splice(c.indexOf(e),1)}),c.forEach(e=>{e.yPos<s*25&&(e.yPos+=25)}))}},M=()=>{y.fillStyle="White",y.fillRect(0,0,h.width,h.height),y.strokeStyle="LightGray";for(let o=0;o<300;o+=25)for(let e=0;e<550;e+=25)y.strokeRect(o,e,25,25);l.fillStyle="White",l.fillRect(0,0,g.width,g.height),l.strokeStyle="LightGray";for(let o=0;o<100;o+=25)for(let e=0;e<100;e+=25)l.strokeRect(o,e,25,25);const s=document.getElementById("gameMessages");s&&(s.innerHTML=E.reduce((o,e)=>`${o}${e}<br>`,`Game speed: ${W}<br>Game messages:<br>`)),t.getCurrentOrientation().forEach(o=>{y.fillStyle=t.colour,y.fillRect(o.xPos,o.yPos,25,25)}),c.forEach(o=>{y.fillStyle=o.colour,y.fillRect(o.xPos,o.yPos,25,25)}),x==null||x.getOrientation(0).forEach(o=>{l.fillStyle=x.colour,l.fillRect(o.xPos-100,o.yPos,25,25)})},j=s=>!!s.find(o=>c.find(e=>o.xPos===e.xPos&&o.yPos===e.yPos)),a=s=>s.find(o=>o.yPos>525||o.yPos<0||o.xPos<0||o.xPos>275||c.find(e=>e.yPos===o.yPos&&e.xPos===o.xPos)),f=s=>{if(s==="up"){const o=t.getNextOrientationIndex(),e=t.getOrientation(o).map(P=>({xPos:P.xPos,yPos:P.yPos}));if(a(e))return;t.setOrientation(o)}if(s==="down"){const o=t.getCurrentOrientation().map(e=>({xPos:e.xPos,yPos:e.yPos+25}));if(a(o)){const e=t.getCurrentOrientation().map(n=>u(d({},n),{colour:t.colour}));c.push(...e);const P=I();j(P.getCurrentOrientation())?A=!0:t=P;return}t.getOrientations().forEach(e=>{e.forEach(P=>P.yPos+=25)})}if(s==="left"){const o=t.getCurrentOrientation().map(e=>u(d({},e),{xPos:e.xPos-25}));if(a(o))return;t.getOrientations().forEach(e=>{e.forEach(P=>P.xPos-=25)})}if(s==="right"){const o=t.getCurrentOrientation().map(e=>u(d({},e),{xPos:e.xPos+25}));if(a(o))return;t.getOrientations().forEach(e=>{e.forEach(P=>P.xPos+=25)})}},z=()=>{let s=!0;for(;s;){const o=t.getCurrentOrientation().map(e=>({xPos:e.xPos,yPos:e.yPos+25}));if(a(o)){s=!1;return}t.getOrientations().forEach(e=>{e.forEach(P=>P.yPos+=25)})}},H=s=>{if(p||(p=requestAnimationFrame(k)),s.code==="ArrowDown")f("down");else if(s.code==="ArrowLeft")f("left");else if(s.code==="ArrowRight")f("right");else if(s.code==="ArrowUp")f("up");else if(s.code==="KeyQ")if(x){const o=C(t);t=C(x),x=o}else x=C(t),t=I();else s.code==="Space"&&z()};addEventListener("load",()=>{h=document.getElementById("mainCanvas"),g=document.getElementById("extraInfoCanvas"),y=h.getContext("2d"),l=g.getContext("2d"),t=I(),document.onkeydown=H,M()});
